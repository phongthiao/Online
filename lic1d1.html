<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phòng Thi Ảo - Đề Kiểm Tra Vật Lý</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* General Styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #1f2937;
        }
        /* Main container for the exam */
        .exam-container {
            max-width: 900px;
            margin: 1rem auto; /* Reduced margin for mobile */
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 1.5rem; /* Padding for mobile */
        }
        /* Header section */
        .exam-header {
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        /* Sticky timer at the top */
        .timer {
            position: sticky;
            top: 0;
            background: linear-gradient(135deg, #4f46e5, #818cf8);
            color: white;
            padding: 1rem;
            text-align: center;
            font-size: 1.25rem; /* Adjusted font size for responsiveness */
            font-weight: 700;
            z-index: 10;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
        }
        /* Individual question block */
        .question-block {
            margin-bottom: 2rem;
            padding: 1rem; /* Adjusted padding */
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        .question-title {
            font-weight: 600;
            margin-bottom: 1rem;
            color: #111827;
            line-height: 1.6;
        }
        /* Option styling for multiple choice */
        .option {
            display: flex;
            align-items: flex-start; /* Align items to the start for long text */
            text-align: left;
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .option:hover {
            background-color: #f3f4f6;
        }
        .option input {
            margin-top: 0.25rem; /* Align radio button better */
            margin-right: 0.75rem;
            flex-shrink: 0;
        }
        /* Short answer input field */
        .short-answer-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            margin-top: 0.5rem;
        }
        /* Action buttons container */
        .action-buttons {
            display: flex;
            flex-direction: column; /* Stack buttons on mobile */
            gap: 1rem;
            margin-top: 2rem;
        }
        /* General button styling */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            width: 100%; /* Full width on mobile */
        }
        .btn-submit {
            background-color: #2563eb;
            color: white;
        }
        .btn-submit:hover {
            background-color: #1d4ed8;
        }
        .btn-redo {
            background-color: #e5e7eb;
            color: #374151;
        }
        .btn-redo:hover {
            background-color: #d1d5db;
        }
        
        /* Result styles */
        .correct { border-left: 5px solid #22c55e; background-color: #f0fdf4; }
        .incorrect { border-left: 5px solid #ef4444; background-color: #fef2f2; }
        .unanswered { border-left: 5px solid #f97316; background-color: #fff7ed; }
        .correct-answer-text { color: #16a34a; font-weight: 600; margin-left: 1rem; }
        .result-summary {
            text-align: center;
            padding: 1.5rem;
            border: 2px dashed #4f46e5;
            border-radius: 12px;
            margin-bottom: 2rem;
            background-color: #fafaff;
        }
        .result-icon { font-size: 1.2rem; margin-left: 0.5rem; }

        /* Responsive True/False Table */
        .true-false-table .statement-cell {
            display: block;
            width: 100%;
            margin-bottom: 0.5rem;
        }
        .true-false-table .option-cell {
            display: inline-block;
            margin-right: 1rem;
        }
        .true-false-table .feedback-cell {
            display: block;
            margin-top: 0.5rem;
        }

        /* Desktop and larger screen adjustments */
        @media (min-width: 768px) {
            .exam-container {
                margin: 2rem auto;
                padding: 2.5rem;
            }
            .question-block {
                padding: 1.5rem;
            }
            .timer {
                font-size: 1.5rem;
            }
            .action-buttons {
                flex-direction: row; /* Buttons side-by-side on desktop */
                justify-content: center;
            }
            .btn {
                width: auto; /* Auto width for buttons on desktop */
            }
            .result-summary {
                padding: 2rem;
            }
             /* Revert True/False table to standard table layout on desktop */
            .true-false-table .statement-cell,
            .true-false-table .option-cell,
            .true-false-table .feedback-cell {
                display: table-cell;
                width: auto;
                margin-bottom: 0;
                margin-right: 0;
                margin-top: 0;
                vertical-align: middle;
            }
             .true-false-table .statement-cell {
                width: 70%;
             }
        }
    </style>
</head>
<body>

    <div class="exam-container">
        <div class="exam-header">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800">ĐỀ KIỂM TRA TOÀN DIỆN CHƯƠNG 1 VẬT LÝ</h1>
            <p class="text-gray-600 mt-2">Thời gian làm bài: 60 phút</p>
        </div>

        <div id="timer" class="timer">Thời gian còn lại: 60:00</div>
        
        <div id="exam-form">
            <!-- PHẦN I -->
            <h2 class="text-xl md:text-2xl font-bold text-indigo-700 mb-4">PHẦN I. CÂU TRẮC NGHIỆM NHIỀU PHƯƠNG ÁN LỰA CHỌN</h2>
            <div id="part1"></div>

            <!-- PHẦN II -->
            <h2 class="text-xl md:text-2xl font-bold text-indigo-700 mt-8 mb-4">PHẦN II. CÂU TRẮC NGHIỆM ĐÚNG SAI</h2>
            <div id="part2"></div>
            
            <!-- PHẦN III -->
            <h2 class="text-xl md:text-2xl font-bold text-indigo-700 mt-8 mb-4">PHẦN III. CÂU TRẮC NGHIỆM TRẢ LỜI NGẮN</h2>
            <div id="part3"></div>

            <div class="action-buttons">
                <button id="submitBtn" class="btn btn-submit">Nộp Bài</button>
                <button id="redoBtn" class="btn btn-redo" style="display: none;">Làm Lại</button>
            </div>
        </div>

        <div id="result-summary" class="result-summary" style="display: none;"></div>
    </div>

    <script>
        // --- SCRIPT FROM PREVIOUS VERSION (NO CHANGES NEEDED FOR RESPONSIVENESS) ---
        const examData = {
            part1: [
                { question: "Gọi F1, F2, F3 lần lượt là độ lớn lực tương tác giữa các phân tử chất rắn, các phân tử chất lỏng, các phân tử chất khí. Sắp xếp theo thứ tự tăng dần là", options: ["F1, F3, F2.", "F3, F2, F1.", "F1, F2, F3.", "F2, F1, F3."], answer: "B" },
                { question: "Hình bên mô tả vòng tuần hoàn của nước. Trong vòng tuần hoàn này có liên quan đến hiện tượng nào sau đây?", options: ["Nóng chảy.", "Thăng hoa.", "Ngưng tụ.", "Ngưng kết."], answer: "C" },
                { question: "Trong một ngày lạnh giá, xoa hai tay vào nhau để làm ấm. Nhiệt lượng mà bàn tay nhận được đến từ đâu?", options: ["Từ năng lượng hóa học trong cơ thể bạn.", "Từ công cơ học do ma sát giữa hai tay.", "Từ nhiệt độ môi trường.", "Từ nội năng của không khí xung quanh."], answer: "B" },
                { question: "Khi phơi quần áo ướt dưới trời nắng, sau một thời gian quần áo khô hoàn toàn. Đây là hiện tượng:", options: ["Ngưng tụ.", "Bay hơi.", "Đông đặc.", "Nóng chảy."], answer: "B" },
                { question: "Chất ở thể rắn có", options: ["thể tích và hình dạng riêng xác định.", "thể tích và hình dạng không xác định.", "thể tích không xác định, hình dạng xác định.", "thể tích xác định, hình dạng không xác định."], answer: "A" },
                { question: "Nhiệt nóng chảy riêng có đơn vị đo là", options: ["J/kg", "J/kg.K", "J/K", "J.kg/K"], answer: "A" },
                { question: "Khi đi tiêm vắc-xin, các bác sĩ thường xoa một lớp cồn lên da trước khi tiêm. Khi thoa cồn lên da, người được tiêm vắc - xin sẽ có cảm giác lạnh trên vùng da đó là vì", options: ["lớp da hấp thụ hơi lạnh từ cồn.", "bác sĩ thực hiện công làm nội năng của da giảm.", "cồn thu nhiệt từ lớp da và bay hơi.", "lớp da thực hiện công làm cồn bay hơi."], answer: "C" },
                { question: "Nhiệt hóa hơi riêng của nước là 2,3.10⁶ J/kg. Câu nào dưới đây là đúng?", options: ["Một lượng nước bất kỳ cần thu một nhiệt lượng là 2,3.10⁶ J để bay hơi hoàn toàn.", "Mỗi kilôgam nước cần thu một lượng nhiệt là 2,3.10⁶ J để bay hơi hoàn toàn.", "Mỗi kilôgam nước sẽ tỏa ra một lượng nhiệt là 2,3.10⁶ J khi bay hơi hoàn toàn ở nhiệt độ sôi.", "Mỗi kilôgam nước cần thu một lượng nhiệt là 2,3.10⁶ J để bay hơi hoàn toàn ở nhiệt độ sôi và áp suất chuẩn."], answer: "D" },
                { question: "Khoảng 70% bề mặt của Trái Đất được bao phủ bởi nước. Vì có ...(1)... nên lượng nước này có thể hấp thụ năng lượng nhiệt khổng lồ của năng lượng Mặt Trời mà vẫn giữ cho ...(2)... của bề mặt Trái Đất tăng không nhanh và không nhiều, tạo điều kiện thuận lợi cho sự sống của con người và các sinh vật khác. Khoảng trống (1) và (2) lần lượt là", options: ["\"nhiệt độ sôi lớn\"; \"áp suất\".", "\"nhiệt độ sôi lớn\"; \"nhiệt độ\".", "\"nhiệt dung riêng lớn\"; \"nhiệt độ\".", "\"nhiệt dung riêng lớn\"; \"áp suất\"."], answer: "C" },
                { question: "Mây được tạo thành từ", options: ["khói.", "nước đông đặc.", "hơi nước ngưng tụ.", "nước bay hơi."], answer: "C" },
                { question: "Quá trình làm thay đổi nội năng của vật bằng cách cho nó tiếp xúc với vật khác khi", options: ["có sự chênh lệch nhiệt độ giữa chúng gọi là sự nhận công.", "có sự chênh lệch nhiệt độ giữa chúng gọi là sự truyền nhiệt.", "nhiệt độ của chúng bằng nhau gọi là sự trao đổi công.", "nhiệt độ của chúng bằng nhau gọi là sự truyền nhiệt."], answer: "B" },
                { question: "Nội năng của một vật phụ thuộc vào", options: ["nhiệt độ và thể tích của vật đó.", "vận tốc và độ cao của vật đó.", "thể tích và độ cao của vật đó.", "nhiệt độ và vận tốc của vật đó."], answer: "A" },
                { question: "Trong nhiệt giai Celsius, nhiệt độ sôi của nước tinh khiết ở áp suất tiêu chuẩn là", options: ["273 K.", "100°C", "0 K.", "0°C."], answer: "B" },
                { question: "Nhiệt lượng cần thiết để làm 1 kg chất lỏng hóa hơi hoàn toàn ở nhiệt độ sôi được gọi là", options: ["nhiệt nóng chảy riêng của chất đó.", "nhiệt hóa hơi của chất đó.", "nhiệt hóa hơi riêng của chất đó.", "nhiệt dung riêng của chất đó."], answer: "C" },
                { question: "Một lượng khí trong một xilanh nhận một nhiệt lượng 350 kJ và thực hiện công 130 kJ đẩy pit-tông đi ra. Độ biến thiên nội năng của lượng khí trong quá trình này là", options: ["220 kJ.", "-220 kJ.", "480 kJ.", "-480 kJ."], answer: "A" },
                { question: "Một tấm nhôm có khối lượng 860 gam, đang ở nhiệt độ 22°C. Biết nhiệt dung riêng của nhôm là 880 J/(kg.K). Để nâng nhiệt độ tấm nhôm lên 100°C cần một nhiệt lượng là", options: ["5,9.10⁴ J.", "7,6.10³ J.", "5,9.10³ J.", "7,6.10⁴ J."], answer: "A" },
                { question: "Sử dụng thông tin sau cho câu 17 và câu 18. Một học sinh sử dụng bộ thiết bị đun có công suất 24W... Kết quả đo được biểu diễn ở đồ thị như hình vẽ. Vật liệu có nhiệt dung riêng nhỏ nhất là", options: ["Bê tông.", "Đồng.", "Sắt.", "Thiếc."], answer: "D" },
                { question: "Nhiệt dung riêng của đồng là", options: ["385 J/kg.K", "380 J/kg.K", "450 J/kg.K", "384 J/kg.K"], answer: "D" }
            ],
            part2: [
                { 
                    context: "Một hệ thống tản nhiệt cho CPU...",
                    statements: [
                        { text: "Bộ làm mát hấp thụ nhiệt từ CPU làm giảm nhiệt độ của CPU.", answer: true },
                        { text: "Nhiệt lượng CPU tỏa ra trong một giờ khi hoạt động bình thường là 750 kJ.", answer: false },
                        { text: "Lưu lượng chất lỏng qua bộ làm mát và lưu lượng khí do quạt thổi quyết định hiệu suất làm mát của hệ thống.", answer: true },
                        { text: "Chênh lệch nhiệt độ của nước đầu vào và đầu ra ở bộ làm mát là 6°C.", answer: true }
                    ]
                },
                {
                    context: "Để khảo sát quá trình truyền nhiệt năng...",
                    statements: [
                        { text: "Số chỉ nhiệt kế trong cốc (1) tăng, số chỉ nhiệt kế trong bình (2) giảm chứng tỏ nhiệt lượng truyền từ vật nóng sang vật lạnh.", answer: true },
                        { text: "Khi số chỉ hai nhiệt kế bằng nhau thì các số chỉ này gần như không thay đổi nữa, điều này chứng tỏ các vật có cùng nhiệt độ không truyền nhiệt cho nhau.", answer: true },
                        { text: "Dụng cụ đo có độ chính xác tương đối cao. Khi cân bằng nhiệt, số chỉ các nhiệt kế có giá trị nằm trong khoảng 62°C đến 65°C.", answer: false },
                        { text: "Số chỉ nhiệt kế trong cốc (1) tăng với tốc độ chậm hơn số chỉ nhiệt kế trong bình (2) giảm xuống.", answer: false }
                    ]
                },
                {
                    context: "Quạt điều hòa là thiết bị làm mát...",
                    statements: [
                        { text: "Nước trong bình chứa được đổ đầy trước khi sử dụng, thời gian sử dụng của quạt cho đến khi hết nước trong bình là 6,27 giờ", answer: false },
                        { text: "Nhiệt độ của không khí giảm 8K khi đi qua các tấm làm mát", answer: true },
                        { text: "Nhiệt lượng mà nước thu vào để hóa hơi trong một giây là 750,4 J", answer: false },
                        { text: "Nhiệt lượng mà nước thu vào để hoá hơi được lấy từ không khí đi qua tấm làm mát", answer: true }
                    ]
                },
                {
                    context: "Cho các số liệu sau: Nhiệt nóng chảy riêng của nước đá...",
                    statements: [
                        { text: "Lượng nhiệt cần cung cấp để làm nóng chảy hoàn toàn 1 kg nước đá trên là 330 kJ.", answer: true },
                        { text: "Khi ở nhiệt độ sôi, lượng nhiệt cần cung cấp để hóa hơi hoàn toàn 1 kg nước trên là 2260 kJ.", answer: true },
                        { text: "Lượng nhiệt cần cung cấp để tăng nhiệt độ của 1 kg nước trên từ 0°C đến 100°C là 4200 J.", answer: false },
                        { text: "Từ trạng thái ban đầu, người ta sử dụng nguồn nhiệt trên để cung cấp nhiệt liên tục cho khối nước đá trên. Khối lượng nước còn lại sau thời gian 30 phút là 0,4646 kg (kết quả sau khi đã làm tròn).", answer: false }
                    ]
                }
            ],
            part3: [
                { question: "Một hệ thống sưởi bằng nước nóng của một căn phòng... Năng lượng nhiệt được truyền từ nước mỗi giờ là bao nhiêu MJ? (Kết quả viết đến chữ số thứ nhất sau dấu phẩy thập phân).", answer: "12.6" },
                { question: "Cho biết nhiệt nóng chảy riêng của nước đá là 334.10³ J/kg. Khi 1 kilogam nước đá nóng chảy hoàn toàn ở nhiệt độ nóng chảy thì cần truyền nhiệt lượng là x.10³ J. Giá trị của x là bao nhiêu?", answer: "334" },
                { question: "Trong một giờ thực hành, một bạn học sinh tiến hành thí nghiệm làm đông đặc nước không cần dùng tủ lạnh... Khối lượng nước được làm đông đặc trong bình là bao nhiêu g? (Làm tròn đến phần nguyên).", answer: "264" },
                { 
                    question: "Đồ thị bên biểu diễn sự phụ thuộc nhiệt độ của một kim loại vào nhiệt lượng. Nhiệt lượng cung cấp cho kim loại trong quá trình nóng chảy là bao nhiêu kJ?", 
                    answer: "195",
                    svg: `<svg viewBox="0 0 500 350" class="w-full max-w-sm mx-auto my-4 bg-gray-50 rounded-lg border">
                            <line x1="50" y1="300" x2="480" y2="300" stroke="black" stroke-width="2"></line>
                            <line x1="50" y1="300" x2="50" y2="20" stroke="black" stroke-width="2"></line>
                            <text x="485" y="320" font-size="16" text-anchor="middle">Q (kJ)</text>
                            <text x="30" y="20" font-size="16" text-anchor="middle">t(°C)</text>
                            <text x="50" y="320" font-size="16" text-anchor="middle">O</text>
                            <polyline points="50,300 290,150 400,150 450,50" fill="none" stroke="#ef4444" stroke-width="3"/>
                            <line x1="290" y1="150" x2="290" y2="300" stroke="black" stroke-width="1" stroke-dasharray="4"></line>
                            <text x="290" y="320" font-size="16" text-anchor="middle">290</text>
                            <line x1="400" y1="150" x2="400" y2="300" stroke="black" stroke-width="1" stroke-dasharray="4"></line>
                            <text x="400" y="320" font-size="16" text-anchor="middle">485</text>
                          </svg>`
                },
                { question: "Biết nhiệt nóng chảy riêng của nước đá là 3,4.10⁵ J/kg. Nhiệt lượng cần cung cấp để làm nóng chảy hoàn toàn 50 g nước đá ở 0°C bằng bao nhiêu kJ (làm tròn kết quả đến chữ số hàng đơn vị)?", answer: "17" },
                { question: "Để pha sữa bột cho con, một người mẹ dùng nước nguội ở 25°C pha với nước nóng ở 100°C để thu được 180 ml nước ở 50°C... Khối lượng nước nguội đã dùng là bao nhiêu kg? (kết quả lấy đến chữ số hàng phần trăm)", answer: "0.12" }
            ]
        };

        const part1Container = document.getElementById('part1');
        const part2Container = document.getElementById('part2');
        const part3Container = document.getElementById('part3');
        const submitBtn = document.getElementById('submitBtn');
        const redoBtn = document.getElementById('redoBtn');
        const resultSummaryContainer = document.getElementById('result-summary');
        const timerEl = document.getElementById('timer');

        let timerInterval;
        let timeRemaining = 3600;

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function startTimer() {
            timerEl.textContent = `Thời gian còn lại: ${formatTime(timeRemaining)}`;
            timerInterval = setInterval(() => {
                timeRemaining--;
                timerEl.textContent = `Thời gian còn lại: ${formatTime(timeRemaining)}`;
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    timerEl.textContent = "Hết giờ!";
                    submitExam();
                }
            }, 1000);
        }

        function loadExam() {
            // Part 1
            examData.part1.forEach((q, index) => {
                const qBlock = document.createElement('div');
                qBlock.className = 'question-block';
                qBlock.id = `p1-q${index}`;
                let optionsHTML = '';
                q.options.forEach((opt, i) => {
                    const optionChar = String.fromCharCode(65 + i);
                    optionsHTML += `
                        <label class="option">
                            <input type="radio" name="p1-q${index}" value="${optionChar}">
                            <span><strong>${optionChar}.</strong> ${opt}</span>
                        </label>
                    `;
                });
                qBlock.innerHTML = `<p class="question-title"><strong>Câu ${index + 1}:</strong> ${q.question}</p>${optionsHTML}`;
                part1Container.appendChild(qBlock);
            });

            // Part 2
            examData.part2.forEach((q, index) => {
                const qBlock = document.createElement('div');
                qBlock.className = 'question-block';
                qBlock.id = `p2-q${index}`;
                let statementsHTML = '<table class="w-full"><tbody>';
                q.statements.forEach((stmt, i) => {
                    const statementChar = String.fromCharCode(97 + i);
                    statementsHTML += `
                        <tr id="p2-q${index}-s${i}" class="true-false-table">
                            <td class="statement-cell py-2"><strong>${statementChar})</strong> ${stmt.text}</td>
                            <td class="option-cell py-2">
                                <label class="option !mb-0 !p-2">
                                    <input type="radio" name="p2-q${index}-s${i}" value="true"> Đúng
                                </label>
                            </td>
                            <td class="option-cell py-2">
                                <label class="option !mb-0 !p-2">
                                    <input type="radio" name="p2-q${index}-s${i}" value="false"> Sai
                                </label>
                            </td>
                            <td class="feedback-cell py-2"></td>
                        </tr>
                    `;
                });
                statementsHTML += '</tbody></table>';
                qBlock.innerHTML = `<p class="question-title"><strong>Câu ${index + 1}:</strong> ${q.context}</p>${statementsHTML}`;
                part2Container.appendChild(qBlock);
            });

            // Part 3
            examData.part3.forEach((q, index) => {
                const qBlock = document.createElement('div');
                qBlock.className = 'question-block';
                qBlock.id = `p3-q${index}`;
                qBlock.innerHTML = `
                    <p class="question-title"><strong>Câu ${index + 1}:</strong> ${q.question}</p>
                    ${q.svg || ''}
                    <input type="text" class="short-answer-input" name="p3-q${index}" placeholder="Nhập câu trả lời của bạn...">
                `;
                part3Container.appendChild(qBlock);
            });
        }
        
        function getResultIcon(isCorrect, isAnswered) {
            if (!isAnswered) return '<span class="result-icon">⚪️</span><span class="text-orange-600 font-medium ml-2">Chưa làm</span>';
            if (isCorrect) return '<span class="result-icon">✅</span>';
            return '<span class="result-icon">❌</span>';
        }

        function submitExam() {
            clearInterval(timerInterval);
            submitBtn.disabled = true;
            submitBtn.style.opacity = '0.5';
            redoBtn.style.display = 'block';

            let scorePart1 = 0, totalPart1 = examData.part1.length, unansweredPart1 = 0;
            let scorePart2 = 0, totalPart2 = examData.part2.reduce((acc, q) => acc + q.statements.length, 0), unansweredPart2 = 0;
            let scorePart3 = 0, totalPart3 = examData.part3.length, unansweredPart3 = 0;

            // Check Part 1
            examData.part1.forEach((q, index) => {
                const qBlock = document.getElementById(`p1-q${index}`);
                const selected = document.querySelector(`input[name="p1-q${index}"]:checked`);
                if (selected) {
                    if (selected.value === q.answer) {
                        scorePart1++;
                        qBlock.classList.add('correct');
                    } else {
                        qBlock.classList.add('incorrect');
                        const correctLabel = Array.from(qBlock.querySelectorAll('.option')).find(label => label.querySelector('input').value === q.answer);
                        if (correctLabel) correctLabel.insertAdjacentHTML('beforeend', `<span class="correct-answer-text">(Đáp án đúng)</span>`);
                    }
                } else {
                    unansweredPart1++;
                    qBlock.classList.add('unanswered');
                    const correctLabel = Array.from(qBlock.querySelectorAll('.option')).find(label => label.querySelector('input').value === q.answer);
                    if (correctLabel) correctLabel.insertAdjacentHTML('beforeend', `<span class="correct-answer-text">(Đáp án đúng)</span>`);
                }
            });

            // Check Part 2
            examData.part2.forEach((q, qIndex) => {
                q.statements.forEach((stmt, sIndex) => {
                    const row = document.getElementById(`p2-q${qIndex}-s${sIndex}`);
                    const feedbackCell = row.querySelector('.feedback-cell');
                    const selected = document.querySelector(`input[name="p2-q${qIndex}-s${sIndex}"]:checked`);
                    let isCorrect = false, isAnswered = false;
                    if (selected) {
                        isAnswered = true;
                        if ((selected.value === 'true' && stmt.answer) || (selected.value === 'false' && !stmt.answer)) {
                            scorePart2++;
                            isCorrect = true;
                        }
                    } else {
                        unansweredPart2++;
                    }
                    feedbackCell.innerHTML = getResultIcon(isCorrect, isAnswered);
                    if(!isCorrect){
                        feedbackCell.innerHTML += `<span class="correct-answer-text">Đáp án: ${stmt.answer ? 'Đúng' : 'Sai'}</span>`;
                    }
                });
            });

            // Check Part 3
            examData.part3.forEach((q, index) => {
                const qBlock = document.getElementById(`p3-q${index}`);
                const input = document.querySelector(`input[name="p3-q${index}"]`);
                if (input.value.trim() !== '') {
                    if (input.value.trim() == q.answer) {
                        scorePart3++;
                        qBlock.classList.add('correct');
                    } else {
                        qBlock.classList.add('incorrect');
                        input.insertAdjacentHTML('afterend', `<div class="mt-2"><span class="correct-answer-text">Đáp án đúng: ${q.answer}</span></div>`);
                    }
                } else {
                    unansweredPart3++;
                    qBlock.classList.add('unanswered');
                    input.insertAdjacentHTML('afterend', `<div class="mt-2"><span class="correct-answer-text">Đáp án đúng: ${q.answer}</span></div>`);
                }
            });

            const totalScore = scorePart1 + scorePart2 + scorePart3;
            const totalQuestions = totalPart1 + totalPart2 + totalPart3;

            resultSummaryContainer.innerHTML = `
                <h2 class="text-2xl md:text-3xl font-bold text-indigo-700 mb-4">Kết Quả Bài Làm</h2>
                <p class="text-lg md:text-xl mb-2"><strong>Tổng điểm:</strong> ${totalScore} / ${totalQuestions}</p>
                <div class="grid md:grid-cols-3 gap-4 text-left mt-6">
                    <div class="p-4 bg-blue-100 rounded-lg">
                        <h3 class="font-bold text-blue-800">Phần I</h3>
                        <p>Số câu đúng: ${scorePart1} / ${totalPart1}</p>
                        <p>Số câu chưa làm: ${unansweredPart1}</p>
                    </div>
                    <div class="p-4 bg-green-100 rounded-lg">
                        <h3 class="font-bold text-green-800">Phần II</h3>
                        <p>Số câu đúng: ${scorePart2} / ${totalPart2}</p>
                        <p>Số câu chưa làm: ${unansweredPart2}</p>
                    </div>
                    <div class="p-4 bg-yellow-100 rounded-lg">
                        <h3 class="font-bold text-yellow-800">Phần III</h3>
                        <p>Số câu đúng: ${scorePart3} / ${totalPart3}</p>
                        <p>Số câu chưa làm: ${unansweredPart3}</p>
                    </div>
                </div>
            `;
            resultSummaryContainer.style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function redoExam() {
            document.getElementById('exam-form').reset();
            document.querySelectorAll('.question-block').forEach(el => el.classList.remove('correct', 'incorrect', 'unanswered'));
            document.querySelectorAll('.correct-answer-text').forEach(el => el.remove());
            document.querySelectorAll('.feedback-cell').forEach(el => el.innerHTML = '');
            submitBtn.disabled = false;
            submitBtn.style.opacity = '1';
            redoBtn.style.display = 'none';
            resultSummaryContainer.style.display = 'none';
            timeRemaining = 3600;
            startTimer();
        }

        submitBtn.addEventListener('click', submitExam);
        redoBtn.addEventListener('click', redoExam);

        window.onload = () => {
            loadExam();
            startTimer();
        };
    </script>
</body>
</html>
